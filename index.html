<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KuhyaKuya Studio Web</title>
  <meta name="description" content="Paket editing modular — InstaClip, Standar, Kreator. Order via WhatsApp." />
  <style>
    :root{
      --bg:#1D1D1D;
      --card:#232323;
      --accent:#FF0072;
      --muted:#bfc3c6;
      --glass: rgba(255,255,255,0.03);
      --gold:#FFD54F;
      --detail:#555;
      --flip-duration:250ms;
      --height-duration:300ms;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:#fff;
      padding:32px;
      display:flex;
      justify-content:center;
      min-height:100vh;
    }
    .container{max-width:1100px;width:100%;padding-bottom:60px;}

    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo img{width:44px;height:44px;border-radius:8px;object-fit:cover}
    h1{font-size:18px}
    p.lead{color:var(--muted);font-size:13px;margin-top:4px;min-height:16px;transition:opacity .5s ease}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px}

    .card-wrapper { position: relative; z-index: 1; }
    .card {
      position: relative;
      width: 100%;
      border-radius: 12px;
      background: var(--card);
      overflow:hidden;
      transition: height var(--height-duration) ease;
    }

    .card-face{
      padding:18px;
      box-shadow:0 6px 18px rgba(0,0,0,0.6);
      border:2px solid rgba(255,255,255,0.05);
      border-radius:12px;
    }

    .card-front, .card-back {
      transition: transform var(--flip-duration) ease, opacity var(--flip-duration) ease;
      transform-origin: center center;
    }

    .card-back {
      visibility:hidden;
      opacity:0;
      transform:scaleX(0);
      position:relative;
    }
    .card.show-back .card-front {
      visibility:hidden;
      opacity:0;
      transform:scaleX(0);
      position:absolute;
      top:0;left:0;width:100%;
    }
    .card.show-back .card-back {
      visibility:visible;
      opacity:1;
      transform:scaleX(1);
    }

    .card-front h3{font-size:16px;margin-bottom:4px}
    .price-box{margin:10px 0}
    .old-price{font-size:12px;color:var(--muted);text-decoration:line-through;display:inline-block;margin-right:6px}
    .disc-badge{display:inline-block;background:var(--accent);color:#fff;font-size:11px;padding:2px 6px;border-radius:6px;vertical-align:middle}
    .price{font-weight:700;font-size:20px;margin-top:2px}
    .meta{color:var(--muted);font-size:13px}
    .list{margin:12px 0 16px;padding-left:18px;color:var(--muted);font-size:14px}
    .badge{display:inline-block;background:var(--glass);padding:4px 10px;border-radius:999px;font-size:12px;color:var(--muted);margin-right:6px;margin-top:4px}

    .cta{text-align:right;margin-top:16px}
    .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;text-decoration:none;display:inline-block;font-size:13px;border:none}
    .btn.detail{background:var(--detail);color:#fff}

    .card-back h4{margin-bottom:10px;font-size:15px;color:var(--gold)}
    .card-back ul{padding-left:18px;color:var(--muted)}

    .back-btn{margin-top:12px;background:var(--detail);color:#fff;border:none;padding:6px 10px;border-radius:8px;cursor:pointer;font-size:12px}

    footer{
      position:fixed;
      bottom:0;
      left:0;
      width:100%;
      background:var(--bg);
      color:var(--muted);
      font-size:13px;
      text-align:center;
      padding:8px 0;
      z-index:10;
    }

    .rekom .card-face{border:2px solid var(--gold)!important;box-shadow:0 0 0 1px rgba(255,213,79,.3), 0 6px 18px rgba(255,213,79,.25)}
    .ribbon{position:absolute;top:14px;right:14px;background:linear-gradient(135deg, var(--gold), #e6b800);color:#2a2200;font-weight:700;padding:4px 8px;border-radius:999px;font-size:11px;z-index:2}

    @media (max-width:560px){
      body{padding:18px}
      .logo img{width:40px;height:40px}
      h1{font-size:16px}
    }
  </style>
</head>
<body>
  <main class="container">
    <header>
      <div class="brand">
        <div class="logo"><img src="assets/Logo.png" alt="Logo"></div>
        <div>
          <h1>KuhyaKuya Studio</h1>
          <p class="lead" id="rotating-text">Desain simple, dark mode, fokus pesan utama. Order cepat via WhatsApp.</p>
        </div>
      </div>
    </header>

    <section class="grid" id="packages"></section>

    <footer>
      <small>© KuhyaKuya Studio</small>
    </footer>
  </main>

  <script src="assets/pricing.js"></script>
  <script>
    const texts=[
      "Harga transparan, kerjaan adil. Satu klik untuk hasil terbaik bagi client dan freelancer.",
      "Jam kerja: Kamis–Selasa 19:00–22:00 • Sabtu–Minggu 09:00–22:00"
    ];
    let idx=0;
    const el=document.getElementById('rotating-text');
    setInterval(()=>{
      idx=(idx+1)%texts.length;
      el.style.opacity=0;
      setTimeout(()=>{
        el.textContent=texts[idx];
        el.style.opacity=1;
      },500);
    },5000);

    const FLIP_DURATION=250;
    const HEIGHT_DURATION=300;

    async function loadPackages(){
      try{
        const {prices, promo} = await Pricing.loadConfig(".");
        renderPackages(prices.packages, promo);
      }catch(e){
        console.error("Load config error:", e);
      }
    }

    function renderPackages(packages,promo){
      const container=document.getElementById('packages');
      container.innerHTML='';
      packages.forEach(pkg=>{
        const {normal, percent, final} = Pricing.getFinalPrice(pkg, promo);
        const isRekom = checkRekom(promo, pkg.id);

        const wrapper=document.createElement('div');
        wrapper.className='card-wrapper';
        wrapper.innerHTML=`
          <div class="card${isRekom?' rekom':''}">
            <div class="card-face card-front">
              ${isRekom?'<div class="ribbon">Rekomendasi</div>':''}
              <h3>${escapeHtml(pkg.name)}</h3>
              <div class="meta">Revisi: ${pkg.revisions} • Durasi: ${pkg.durationText} • Waktu: ${pkg.leadTime}</div>
              <div class="price-box">
                ${percent>0?`<span class="old-price">IDR ${numberWithSeparators(normal)}</span><span class="disc-badge">-${percent}%</span>`:''}
                <div class="price">IDR ${numberWithSeparators(final)}</div>
              </div>
              <ul class="list">${(pkg.features||[]).map(f=>`<li>${escapeHtml(f)}</li>`).join('')}</ul>
              <div>${(pkg.tags||[]).map(t=>`<span class="badge">${escapeHtml(t)}</span>`).join('')}</div>
              <div class="cta">
                <a class="btn" href="./order/${pkg.id}/">Order</a>
                <button class="btn detail flip-btn" type="button">Detail</button>
              </div>
            </div>
            <div class="card-face card-back">
              <h4>Kebijakan</h4>
              <ul>${(pkg.policies||["Tidak ada kebijakan tambahan"]).map(p=>`<li>${escapeHtml(p)}</li>`).join('')}</ul>
              <button class="back-btn">← Kembali</button>
            </div>
          </div>`;

        const card=wrapper.querySelector('.card');
        const front=wrapper.querySelector('.card-front');
        const back=wrapper.querySelector('.card-back');

        const flip = (toBack) => {
          const showEl = toBack ? back : front;
          const hideEl = toBack ? front : back;

          // animasi keluar
          hideEl.style.transform = 'scaleX(0)';
          hideEl.style.opacity = '0';

          setTimeout(()=>{
            card.classList.toggle('show-back', toBack);
            // reset transform supaya bisa scale in
            showEl.style.transform = 'scaleX(0)';
            showEl.style.opacity = '0';
            void showEl.offsetWidth;
            showEl.style.transform = 'scaleX(1)';
            showEl.style.opacity = '1';
          }, FLIP_DURATION);
        };

        wrapper.querySelector('.flip-btn').addEventListener('click',()=>flip(true));
        wrapper.querySelector('.back-btn').addEventListener('click',()=>flip(false));

        container.appendChild(wrapper);
      });
    }

    function checkRekom(promo,id){
      if(!promo||!promo.recommended) return false;
      if(Array.isArray(promo.recommended)) return promo.recommended.map(String).includes(String(id));
      return String(promo.recommended)===String(id);
    }

    function numberWithSeparators(x){return x?.toString().replace(/\B(?=(\d{3})+(?!\d))/g,',')||'0'}
    function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]))}

    loadPackages();
  </script>
  <script>
    // --- Override flip behaviour with scaleX two-phase + height easing ---
    (function(){
      const FLIP_DURATION = 250; // ms
      const HEIGHT_DURATION = 300; // ms

      function initCards(){
        document.querySelectorAll('.card').forEach(card=>{
          const front = card.querySelector('.card-front');
          const back  = card.querySelector('.card-back');
          if(!front || !back) return;

          // Ensure clean initial state
          front.style.display = 'block';
          front.style.transform = 'scaleX(1)';
          front.style.opacity = '1';
          back.style.display = 'none';
          back.style.transform = 'scaleX(0)';
          back.style.opacity = '0';
          card.style.height = front.offsetHeight + 'px';

          // Replace existing buttons to remove old listeners
          const flipBtn = card.querySelector('.flip-btn');
          const backBtn = card.querySelector('.back-btn');
          if(flipBtn){ const n=flipBtn.cloneNode(true); flipBtn.replaceWith(n); }
          if(backBtn){ const n=backBtn.cloneNode(true); backBtn.replaceWith(n); }

          const newFlipBtn = card.querySelector('.flip-btn');
          const newBackBtn = card.querySelector('.back-btn');

          const animateHeight = (target)=>{
            card.style.transition = `height ${HEIGHT_DURATION}ms ease`;
            void card.offsetHeight; // reflow
            card.style.height = target + 'px';
            const onEnd = ()=>{ card.removeEventListener('transitionend', onEnd); card.style.transition=''; card.style.height='auto'; };
            card.addEventListener('transitionend', onEnd);
          };

          const flip = (toBack)=>{
            const fromEl = toBack ? front : back;
            const toEl   = toBack ? back  : front;

            // Phase 1: hide current face with scaleX
            fromEl.style.transition = `transform ${FLIP_DURATION}ms ease, opacity ${FLIP_DURATION}ms ease`;
            fromEl.style.transform = 'scaleX(0)';
            fromEl.style.opacity = '0';

            setTimeout(()=>{
              // Swap faces
              fromEl.style.display = 'none';
              toEl.style.display = 'block';
              toEl.style.transform = 'scaleX(0)';
              toEl.style.opacity = '0';

              // Height to match new face
              animateHeight(toEl.offsetHeight);

              // Phase 2: show target face
              toEl.style.transition = `transform ${FLIP_DURATION}ms ease, opacity ${FLIP_DURATION}ms ease`;
              void toEl.offsetWidth;
              toEl.style.transform = 'scaleX(1)';
              toEl.style.opacity = '1';
            }, FLIP_DURATION);
          };

          if(newFlipBtn) newFlipBtn.addEventListener('click', ()=> flip(true));
          if(newBackBtn) newBackBtn.addEventListener('click', ()=> flip(false));
        });
      }

      // Run after initial render; also observe for future re-renders if any
      const start = ()=> setTimeout(initCards, 0);
      if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', start); else start();
    })();
  </script>
</body>
</html>
